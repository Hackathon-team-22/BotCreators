## 1. Справочник Use Case’ов

| UC ID     | Название (что делает)                                                             |
|-----------|-----------------------------------------------------------------------------------|
| **UC-01** | Загрузить историю чата (получить файл(ы) экспорта от пользователя)                |
| **UC-02** | Провалидировать и зарегистрировать файлы (формат, количество, лимиты TG)          |
| **UC-03** | Распарсить экспорт (HTML/JSON → внутреннее представление сообщений)               |
| **UC-04** | Извлечь авторов сообщений (все пользователи, писавшие в чат)                      |
| **UC-05** | Извлечь упоминания (@username в тексте сообщений)                                 |
| **UC-06** | Классифицировать сущности (пользователь / упоминание / канал / удалённый аккаунт) |
| **UC-07** | Построить набор уникальных участников (дедуп, фильтрация удалённых)               |
| **UC-08** | Выбрать формат результата (список в чат или Excel)                                |
| **UC-09** | Сформировать inline-список для чата (< 50 участников)                             |
| **UC-10** | Сформировать Excel-отчёт (структура, вкладки, кодировка)                          |
| **UC-11** | Отправить результат пользователю (сообщение / файл)                               |
| **UC-12** | Показать подсказки и ограничения (лимиты TG, формат входа, что делать)            |
| **UC-13** | Очистить временные данные (файлы, в памяти)                                       |
| **UC-14** | Развернуть бота (Docker, GitHub, окружение)                                       |
| **UC-15** | Предоставить документацию и примеры отчётов                                       |

---

## 2. Справочник компонент реализации (абстрактно, без путей)

| Компонент                    | Роль                                                              |
|------------------------------|-------------------------------------------------------------------|
| **C1 BotInterface**          | Обработчики Telegram Bot API, маршрутизация команд и сообщений    |
| **C2 FileIntake**            | Приём файлов, проверка количества/размера, базовая валидация      |
| **C3 ExportParser**          | Парсинг HTML/JSON экспорта Telegram в поток сообщений/событий     |
| **C4 ParticipantService**    | Извлечение авторов, дедупликация, фильтрация удалённых аккаунтов  |
| **C5 ChannelMentionService** | Выделение упоминаний, каналов, разделение по категориям           |
| **C6 OutputSelector**        | Логика выбора: список vs Excel, правила порога (50)               |
| **C7 ExcelGenerator**        | Формирование Excel с нужными колонками и вкладками, кодировка     |
| **C8 PrivacyManager**        | Жизненный цикл данных: «на лету», уничтожение после обработки     |
| **C9 DeploymentArtifacts**   | Dockerfile, docker-compose, GitHub-репозиторий, скрипты запуска   |
| **C10 DocsAndUX**            | Тексты подсказок, инструкция, описание ограничений, пример отчёта |

---

## 3. Матрица трассируемости (Источник → Требование → UC → Реализация)

### 3.1. Функциональные требования

| Req ID  | Требование (нормализовано)                                                                                          | Источники | Use Case’ы                 | Компоненты  |
|---------|---------------------------------------------------------------------------------------------------------------------|-----------|----------------------------|-------------|
| **R1**  | Бот принимает файлы экспорта истории Telegram-чата (1 или несколько)                                                | [V][T]    | UC-01, UC-02               | C1, C2      |
| **R2**  | Лимит количества файлов определяется лимитами Telegram и явно сообщается пользователю                               | [V][T][A] | UC-02, UC-12               | C1, C2, C10 |
| **R3**  | Поддержка больших файлов и всего диапазона допустимых размеров/типов экспорта (HTML/JSON)                           | [V][T]    | UC-02, UC-03               | C2, C3      |
| **R4**  | Извлечение всех пользователей, писавших в чат (авторы сообщений)                                                    | [V][T]    | UC-03, UC-04               | C3, C4      |
| **R5**  | Извлечение всех пользователей, упомянутых в тексте сообщений (@username)                                            | [V][T]    | UC-03, UC-05               | C3, C5      |
| **R6**  | Пользователи, которые не писали и не упоминались, не могут быть извлечены — это допустимое ограничение              | [V]       | UC-04, UC-05, UC-07        | C4, C5      |
| **R7**  | Исключение удалённых аккаунтов из результата                                                                        | [V][T]    | UC-06, UC-07               | C4          |
| **R8**  | Дедупликация: один пользователь представлен строго одной записью                                                    | [V][T][A] | UC-06, UC-07               | C4          |
| **R9**  | Обработка каналов: сообщения от имени каналов не считаются участниками                                              | [V][T]    | UC-03, UC-06               | C3, C5      |
| **R10** | Каналы должны быть вынесены в отдельную категорию и отображаться на отдельной вкладке Excel                         | [V][T]    | UC-06, UC-10               | C5, C7      |
| **R11** | Упомянутые, но не являющиеся участниками, пользователи — отдельная категория (отдельная вкладка Excel)              | [V][T]    | UC-05, UC-06, UC-10        | C5, C7      |
| **R12** | Для каждого пользователя извлекаются: username, имя и фамилия, описание профиля (bio)                               | [V][T]    | UC-03, UC-04, UC-05, UC-07 | C3, C4, C5  |
| **R13** | По возможности извлекается дата регистрации пользователя                                                            | [V][T]    | UC-03, UC-04, UC-05, UC-07 | C3, C4, C5  |
| **R14** | Определяется признак «наличие канала в профиле» (если возможно)                                                     | [T]       | UC-03, UC-06, UC-07        | C3, C5      |
| **R15** | При участниках < 50 бот отправляет список username прямо в чат                                                      | [V][T]    | UC-08, UC-09, UC-11        | C6, C1      |
| **R16** | При участниках ≥ 51 бот формирует Excel и отправляет только файл, без текстового дублирования                       | [V][T]    | UC-08, UC-10, UC-11        | C6, C7, C1  |
| **R17** | Excel имеет фиксированные колонки: дата экспорта, username, имя+фамилия, описание, дата регистрации, наличие канала | [V][T]    | UC-10                      | C7          |
| **R18** | Excel содержит несколько вкладок: участники, упоминания, каналы                                                     | [V][T]    | UC-10                      | C7          |
| **R19** | Пример выгрузки (Excel и/или скриншоты) должен быть предоставлен                                                    | [T]       | UC-15                      | C7, C10     |

---

### 3.2. Конфиденциальность и жизненный цикл данных

| Req ID  | Требование                                                                        | Источники | Use Case’ы                 | Компоненты |
|---------|-----------------------------------------------------------------------------------|-----------|----------------------------|------------|
| **R20** | Бот не хранит пользовательские данные на сервере, обработка «на лету»             | [V][T]    | UC-01, UC-02, UC-03, UC-13 | C2, C3, C8 |
| **R21** | Файлы экспорта не сохраняются на диск после обработки, временные данные удаляются | [V][T]    | UC-13                      | C8         |
| **R22** | Поведение с ПДн минимизирует риски (отсутствие долговременного хранилища)         | [V][T]    | UC-13                      | C8         |

---

### 3.3. UX / UI и соответствие задачам заказчика

| Req ID  | Требование                                                                                      | Источники | Use Case’ы                               | Компоненты         |
|---------|-------------------------------------------------------------------------------------------------|-----------|------------------------------------------|--------------------|
| **R23** | Бот действительно помогает заказчику видеть участников чата и использовать данные по назначению | [A]       | UC-04, UC-05, UC-07, UC-09, UC-10, UC-11 | C4, C5, C6, C7, C1 |
| **R24** | UX должен быть понятным: простой сценарий загрузки, ожидания и получения результата             | [V][T][A] | UC-01, UC-11, UC-12                      | C1, C10            |
| **R25** | Бот сообщает пользователю ограничения: количество файлов, формат экспорта, возможные ошибки     | [T][A]    | UC-02, UC-12                             | C1, C2, C10        |
| **R26** | Диалог с ботом удобный, структура сообщений ясная, UX не мешает использованию                   | [A]       | UC-01, UC-11, UC-12                      | C1, C10            |
| **R27** | Решение должно быть пригодно для реальной работы (не только демо)                               | [A]       | UC-01…UC-13                              | все C1–C8          |

---

### 3.4. Качество реализации, архитектура, надёжность

| Req ID  | Требование                                                                              | Источники | Use Case’ы                        | Компоненты                   |
|---------|-----------------------------------------------------------------------------------------|-----------|-----------------------------------|------------------------------|
| **R28** | Полное соответствие требованиям брифа (функционал из ТЗ)                                | [A]       | все UC-01…UC-13                   | все C1–C8                    |
| **R29** | Архитектура продуманная: код структурирован, логика обработки прозрачна                 | [A]       | UC-03–UC-10                       | C3, C4, C5, C6, C7           |
| **R30** | Есть документация по архитектуре и структуре решения                                    | [T][A]    | UC-15                             | C10                          |
| **R31** | Бот работает стабильно, без падений и нестабильного поведения                           | [A]       | UC-01…UC-13                       | все runtime-компоненты C1–C8 |
| **R32** | Бот не должен «зависать слишком долго» при обработке (разумное время отклика)           | [V][T][A] | UC-03, UC-04, UC-05, UC-07, UC-10 | C3, C4, C5, C7               |
| **R33** | Бот должен корректно обрабатывать большие истории и множество файлов, без утечек памяти | [V][T][A] | UC-02, UC-03, UC-07, UC-10        | C2, C3, C4, C7, C8           |
| **R34** | Не должно быть проблем с кодировкой (UTF-8 и корректное отображение в Excel и в чате)   | [V][T]    | UC-03, UC-10, UC-11               | C3, C7, C1                   |

---

### 3.5. Развёртывание и артефакты

| Req ID  | Требование                                                                           | Источники | Use Case’ы   | Компоненты |
|---------|--------------------------------------------------------------------------------------|-----------|--------------|------------|
| **R35** | Проект в полном виде размещён в GitHub-репозитории                                   | [V][T]    | UC-14        | C9         |
| **R36** | Проект полностью поднимается в Docker (Dockerfile / docker-compose)                  | [V][T][A] | UC-14        | C9         |
| **R37** | Запуск бота должен быть простым и повторяемым (инструкции, минимальный набор команд) | [T][A]    | UC-14, UC-15 | C9, C10    |
| **R38** | Язык реализации не фиксирован, но должен быть задокументирован и поддерживаем        | [V][T]    | UC-14, UC-15 | C9, C10    |
| **R39** | Должны быть инструкции по запуску и по использованию (user guide + tech guide)       | [T][A]    | UC-14, UC-15 | C9, C10    |

